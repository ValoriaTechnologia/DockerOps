# Stack to deploy DockerOps as a service in Docker Swarm (daemon mode).
# Build the image first: docker build -t dockerops:latest .
# Create the GitHub token secret: echo -n "ghp_xxx" | docker secret create github_token -
# Deploy: docker stack deploy -c deploy/dockerops-stack.yml dockerops

version: "3.8"

services:
  dockerops:
    image: dockerops:latest
    command: ["run"]
    environment:
      DOCKEROPS_DB_PATH: /data/dockerops.db
      DOCKEROPS_SYNC_INTERVAL: "300"
      # Comma- or semicolon-separated list of GitHub repo URLs to watch on startup
      DOCKEROPS_REPOS: "https://github.com/org/repo1"
    secrets:
      - source: github_token
        target: /run/secrets/github_token
    volumes:
      - dockerops-data:/data
      - type: bind
        source: /var/run/docker.sock
        target: /var/run/docker.sock
    placement:
      constraints:
        - node.role == manager

secrets:
  github_token:
    external: true

volumes:
  dockerops-data:
